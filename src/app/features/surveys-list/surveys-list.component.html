<div class="min-h-screen bg-gray-50">
  <app-navbar></app-navbar>

  <div class="ml-[84px] min-h-screen">
    <div class="page-wrapper">
      <!-- Header -->
      <div class="list-header">
        <div>
          <h1 class="page-title">Gestion des sondages</h1>
          <p class="page-subtitle">Gerez vos sondages et activez celui a afficher</p>
        </div>
        <div class="header-actions">
          <a routerLink="/dashboard" class="btn-action btn-action-secondary">
            Retour au dashboard
          </a>
          <a routerLink="/surveys/create" class="btn-action btn-action-primary">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 1rem; height: 1rem;">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
            Nouveau sondage
          </a>
        </div>
      </div>

      <!-- Info Card -->
      <div class="info-box" style="margin-bottom: 1.5rem;">
        <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 1.25rem; height: 1.25rem; flex-shrink: 0; color: #3b82f6;">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
          </svg>
          <div>
            <p class="info-box-text" style="font-weight: 500; margin-bottom: 0.25rem;">Un seul sondage actif a la fois</p>
            <p class="info-box-text">Activer un sondage desactivera automatiquement les autres.</p>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      @if (loading()) {
        <div class="loading-container">
          <div class="loading-spinner"></div>
        </div>
      }

      <!-- Error State -->
      @if (error()) {
        <div class="page-card">
          <div class="error-box">
            <p class="error-box-text">{{ error() }}</p>
          </div>
          <button (click)="loadSurveys()" class="btn-action btn-action-primary" style="margin-top: 1rem;">Reessayer</button>
        </div>
      }

      <!-- Empty State -->
      @if (!loading() && !error() && surveys().length === 0) {
        <div class="page-card">
          <div class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="empty-state-icon">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
            </svg>
            <h3 class="empty-state-title">Aucun sondage</h3>
            <p class="empty-state-text">Commencez par creer votre premier sondage</p>
            <a routerLink="/surveys/create" class="btn-action btn-action-primary" style="margin-top: 1rem;">
              Creer un sondage
            </a>
          </div>
        </div>
      }

      <!-- Surveys List -->
      @if (!loading() && !error() && surveys().length > 0) {
        <div class="surveys-list">
          @for (survey of surveys(); track survey.id) {
            <div class="page-card survey-card" [class.survey-active]="survey.is_active">
              <div class="survey-row">
                <!-- Survey Info -->
                <div class="survey-info">
                  <div class="survey-header">
                    <h3 class="survey-title">{{ survey.title }}</h3>
                    @if (survey.is_active) {
                      <span class="badge badge-success">ACTIF</span>
                    } @else {
                      <span class="badge badge-gray">Inactif</span>
                    }
                  </div>
                  <p class="survey-description">{{ survey.description }}</p>
                  <div class="survey-meta">
                    <span class="meta-item">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                      </svg>
                      {{ formatDate(survey.created_at) }}
                    </span>
                    <span class="meta-item">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z" />
                      </svg>
                      {{ survey.response_count || 0 }} reponses
                    </span>
                    <span class="meta-item">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                      </svg>
                      {{ survey.creator_email }}
                    </span>
                  </div>
                </div>

                <!-- Actions -->
                <div class="survey-actions">
                  @if (actionLoading() === survey.id) {
                    <div class="loading-spinner" style="width: 1.5rem; height: 1.5rem;"></div>
                  } @else {
                    @if (!survey.is_active) {
                      <button
                        (click)="activateSurvey(survey)"
                        class="btn-action btn-action-success">
                        Activer
                      </button>
                    } @else {
                      <button
                        (click)="deactivateSurvey(survey)"
                        class="btn-action btn-action-warning">
                        Desactiver
                      </button>
                    }
                    <a
                      [routerLink]="['/surveys', survey.id, 'results']"
                      class="btn-action btn-action-primary">
                      Resultats
                    </a>
                    <button
                      (click)="deleteSurvey(survey)"
                      class="btn-action btn-action-danger">
                      Supprimer
                    </button>
                  }
                </div>
              </div>
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>
